
Исследуемый файл представляет собой файл PCAP  с размером 9.6 MB (10,027,488  bytes)
Изначально, злоумышленник получил доступ по протоколу  SMB c IP адреса 10.0.0.130. Предположительно, именно эта точка служила точкой входа злоумышлениика в сеть.
 В `Statistics -> Protocol Hierarchy` указаны все протоколы, используемое в сетевом трафике. При анализе было зафиксировано явное присутствие  SMB  - протокола, который часто связан с обменом файлов и доступом к сетевым ресурсам в сетях Windows. Путем изучения трафика связанным с SMB, становится очевидным, что переговоры переходили между двумя адресами 10.0.0.130 10.0.0.133.
 В ходе этого можно увидеть, что ip  10.0.0.130 отправил запрос на протокол переговоров для 10.0.0.133. В ходе этого процесса использовался был использован порт 445.
![[Pasted image 20250716151734.png]]
![[Pasted image 20250715145557.png]]
SMB-атаки могут быть направлены на получение доступа к файлам или выполнение кода на удаленном компьютере.
SMB трафик показывает наличие NTLM, который является протколом аутентификации в среде windows. Он включает в себя обмен сообщениями для переговоров, вызовов/ ответов между клиентом и сервером. Сервер отвечает клиенту сообщением, содержащим данные о целевой машине. В нем указаны ключевые атрибуты, такие как доменное имя, имя компьютера, домен. В извлеченной информации извлеченное имя указывается sales-pc. Злоумышленник использует порт 445, чтобы установить связь с sales-pc. Это характерно черта тактики бокового движения, когда злоумышленник пытается расширить свой охват  и установить контроль над дополнительными ресурсами в скомпрометированной среде. Знание скомпрометиронного имени ведущего дает ценную информацию о прогресее атаки и создает основу для дальнейшего расследования глубины и масштабов компромисса 

![[Pasted image 20250723111023.png]]

2. To fully understand the extent of the breach, can you determine the machine's hostname to which the attacker first pivoted?
При установке сессии отображается информация аутентификации, которая в себя вклбчает идентификатор сеанса и имя учетной записи, используемое во время аутентификации. Имя пользователя ssales соответствует имени  пользователя используемым во время аутентификации, принадлежит хосту HR-PC. Используется метод аутентификации challenge-response, то есть пароль не передается напрямую. Таким образом, использование учентной записи ssales, предполагает,  что злоумышленник либо скомпрометировал эту учетную запись пользователя, либо использовал украденные учетные данные для аутентификации и получения доступа к целевой системе. Это критически важный индикатор компрометации, поскольку он указывает какая именно учетная запись была использована в атаке



3. Knowing the username of the account the attacker used for authentication will give us insights into the extent of the breach. What is the username utilized by the attacker for authentication?


![[Pasted image 20250715153114.png]]


4. After figuring out how the attacker moved within our network, we need to know what they did on the target machine. What's the name of the service executable the attacker set up on the target?
При анализе пакетов smb в потоке tcp есть сообщение, которое указывает на то, что злоумышленник выдал create request через smb для настройки сервера, исполняемого на целевой машине. Злоумышленник создает файл с именем PSEXESVC.exe на целевой машине. Обнаружение такого файла в сетевом трафике сигнализирует о том, что они учавствуют в несанкционированных и вредоносных операциях. Это легитимный инструмент, который используется для удаленного управления. После передачи такого файла, сервис выполняется, предоставляя злоумышленнику возможности удаленного доступа и выполнения на скомпрометированном хосте. 

![[Pasted image 20250723115658.png]]

5. We need to know how the attacker installed the service on the compromised machine to understand the attacker's lateral movement tactics. This can help identify other affected systems. Which network share was used by PsExec to install the service on the target machine?

Для того, чтобы получить доступ к установке службы на скомпрометированную машину злоумышленник использовал тактику бокового движения. 
Из анализа пакета SMB2 Create Request было зафиксировано наличие идентификатора дерева, указывающего на \\10.0.0.133\ADMIN$. Вероятно, использование ADMIN$  позволило злоумышленнику удаленно скопировать PsExec, инициировать исполнение этого файла и получить удаленный доступ. Такая тактика является индиктором бокового движения, поскольку предоставила злоумышленнику доступ к привилегированным сетевым ресурсам и учетных данных

![[Pasted image 20250715154156.png]]

6. We must identify the network share used to communicate between the two machines. Which network share did PsExec use for communication?
 В процессе анализа были зафиксированы запросы, свидетельствующие о подключении к административному ресурсу \\10.0.0.133\IPC$ 

Данный ресурс (IPC$, Inter-Process Communication) представляет собой специальный административный сетевой ресурс в операционных системах Windows, предназначенный не для хранения данных, а для организации взаимодействия между процессами (в том числе удалёнными). Он активно используется для выполнения административных операций, включая аутентификацию, удалённое управление службами, и вызовы процедур через RPC (Remote Procedure Call).

На основании анализа атрибутов SMB-сессии установлено, что подключение к IPC$ было осуществлено с использованием ранее скомпрометированной учётной записи ssales. Взаимодействие происходило по протоколу SMB2 через порт TCP 445, что соответствует стандартному сценарию использования данного ресурса для административных целей.

Дополнительно зафиксировано использование инструмента PsExec, который осуществляет удалённый запуск процессов и команд посредством создания службы на целевом хосте. PsExec, в своём механизме работы, полагается на IPC$ как канал для передачи управляющих команд и выполнения удалённых процедур.

Факт подключения к IPC$ с использованием привилегированной учётной записи, а также характер последующих действий, позволяет классифицировать данный этап как латеральное перемещение (lateral movement) внутри сети.


![[Pasted image 20250715154839.png]]
6. Now that we have a clearer picture of the attacker's activities on the compromised machine, it's important to identify any further lateral movement. What is the hostname of the second machine the attacker targeted to pivot within our network?

Анализ захваченного сетевого трафика позволил определить вторую целевую систему, на которую злоумышленник направил попытку подключения в рамках бокового перемещения. В трафике зафиксировано установление новой SMB-сессии с IP-адреса атакующего (10.0.0.130) на IP-адрес 10.0.0.131.

В рамках SMB-сессии наблюдается SMB Negotiate Protocol Request, за которым следует Session Setup Request, содержащий данные протокола аутентификации NTLM (NT LAN Manager). Ответная Challenge Response от целевой машины позволила извлечь имя компьютера MARKETING-PC

Указанные параметры однозначно идентифицируют целевой хост как MARKETING-PC.

Дополнительно установлено, что сессия завершилась ошибкой STATUS_LOGON_FAILURE, что свидетельствует о неудачной попытке аутентификации. 
![[Pasted image 20250723130517.png]]